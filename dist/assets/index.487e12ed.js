!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const a of t)if("childList"===a.type)for(const t of a.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();class t{constructor(t){this.dataValute=t.Valute,this.favouritesValute={},this.pageHeadline="Курс валют ЦБ РФ на сегодня",this.clickListener=this.favouritesClickListener.bind(this),this.getFavouritesInLocalStorage(),main.addEventListener("click",this.clickListener)}getPageContent(){return`\n    \t\t${this.getPageHeadline()}\n    \t\t${this.getTable(this.dataValute,this.favouritesValute)}\n\n    \t`}getPageHeadline(){const t=new Date,e=`${t.getDate()}/${t.getMonth()}/${t.getFullYear()}`;return`<h1>\n\t      \t${this.pageHeadline} (${e})\n\t      </h1>`}getTable(t,e){return this.isEmpty(e)?`\n\t\t    \t${this.getHeadTable()}\n\t\t    \t<div id="table" class="table"> \n\t\t    \t\t${Object.keys(t).map((e=>this.getTableRows(t[e]))).join("")}\n\t\t    \t</div>`:`\n\t\t    \t${this.getHeadTable()}\n\t\t    \t<div id="table" class="table">\n\t\t    \t\t${Object.keys(e).map((t=>this.getTableRows(e[t],!0))).join("")}\n\t\t    \t\t${Object.keys(t).map((e=>this.getTableRows(t[e],!1))).join("")}\n\t\t    \t</div>`}getHeadTable(){return'\n    \t\t<div class="table-row table-head">\n    \t\t\t<div class="table-col-1">Код</div>\n    \t\t\t<div class="table-col-2">Номинал</div>\n    \t\t\t<div class="table-col-3">Валюта</div>\n    \t\t\t<div class="table-col-4">Курс ЦБ</div>\n    \t\t\t<div class="table-col-5 text-right">Избранное</div>\n    \t\t</div>\n    \t'}getTableRows(t,e){let a,n,i,s=parseFloat(t.Previous)-parseFloat(t.Value),o=parseFloat(t.Value)/parseFloat(t.Previous)*100-100;return s=s.toFixed(4),o=o.toFixed(2),n=e?"table-row-favourite":"-",t.Previous>t.Value?(a="red",i=""):(a="green",i="+"),`\n    \t\t<div class="table-row ${n}" data-charcode="${t.CharCode}">\n    \t\t\t<div class="table-col-1 table-item-char">${t.CharCode}</div>\n    \t\t\t<div class="table-col-2 table-item-nominal">${t.Nominal} </div>\n    \t\t\t<div class="table-col-3 table-item-name">${t.Name}</div>\n    \t\t\t<div class="table-col-4 table-item-value">${t.Value}<label class="value-difference ${a}">${i}${o}%</label></div>\n    \t\t\t<div class="table-col-5 table-item-favourites">\n    \t\t\t<svg class="favourites-icon"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="1.5"  stroke-linecap="round"  stroke-linejoin="round">  \n    \t\t\t\t<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />\n    \t\t\t\t</svg>\n    \t\t\t</div>\n    \t\t</div>\n    \t`}getFavouritesButton(){return'\n    \t\t<div id="favouritesButton" class="favourites-button" onclick="window.scrollTo({top: 0, behavior: \'smooth\'})">\n    \t\t\t<div class="favourites-count"><div id="favouritesCount" class="favourites-count-num">12</div></div>\n    \t\t\t<svg class="favourite-icon"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="1.5"  stroke-linecap="round"  stroke-linejoin="round">  \n    \t\t\t\t<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />\n    \t\t\t</svg>\n    \t\t</div>\n    \t'}favouritesClickListener(t){if(t.target.closest(".favourites-icon")){const e=t.target.closest(".table-row"),a=e.dataset.charcode;-1!=this.favourites.indexOf(a)?this.removeFavorite(e,a):this.addFavorite(e,a)}}addFavorite(t,e){0===this.favourites.length&&this.addFavouritesButton(),this.favourites.push(e),this.updateFavouritesButtonCount(),this.setFavouritesInLocalStorage(),t.classList.add("table-row-favourite"),table.prepend(t)}removeFavorite(t,e){const a=this.favourites.indexOf(e);this.favourites.splice(a,1),0===this.favourites.length?this.removeFavouritesButton():this.updateFavouritesButtonCount(),this.setFavouritesInLocalStorage(),t.classList.remove("table-row-favourite"),table.append(t)}parseValute(){this.favourites.forEach((t=>{this.favouritesValute[t]=this.dataValute[t],delete this.dataValute[t]}))}getFavouritesInLocalStorage(){localStorage.favourites?(this.favourites=JSON.parse(localStorage.getItem("favourites")),this.parseValute()):this.favourites=[]}setFavouritesInLocalStorage(){localStorage.setItem("favourites",JSON.stringify(this.favourites))}isEmpty(t){return 0===Object.keys(t).length}addFavouritesButton(){main.insertAdjacentHTML("beforeend",this.getFavouritesButton())}removeFavouritesButton(){favouritesButton.remove()}updateFavouritesButtonCount(){favouritesCount.innerHTML=this.favourites.length}render(){main.innerHTML=this.getPageContent(),this.favourites.length>0&&(this.addFavouritesButton(),this.updateFavouritesButtonCount())}removeListeners(){main.removeEventListener("click",this.clickListener)}}class e{constructor(t){this.pageHeadline="Конвертер валют",this.dataValute=Object.assign({},t.Valute),this.dataValute.RUR={Nominal:1,Value:1,Name:"Рубль РФ"},this.valuteInputDefault="USD",this.valuteOutputDefault="RUR",this.valuteNameIn=this.dataValute.USD.Name,this.valuteNameOut=this.dataValute.RUR.Name,this.valuteIn=this.valuteInputDefault,this.valuteNominalIn=1,this.valuteOut=this.valuteOutputDefault,this.valuteNominalOut=1,this.valuteInputIn=1,console.log(this.dataValute)}getPageHeadline(){return`<h1>\n\t      \t${this.pageHeadline}\n\t      </h1>`}getInputIn(t){return`\n    \t\t\t<input type="number"  id="inputValuteIn" value="${t}" class="exchange-input text-extra">\n    \t\t`}getInputOut(t){return`\n\t    \t\t<input type="number"  id="inputValuteOut" value="${t}" class="exchange-input text-extra pointer-events-none">\n\t    \t`}getSelector(t,e){return`<select class="exchange-select" id="${e}">\n\t    \t\t${Object.keys(this.dataValute).map((e=>(console.log(e),this.getOption(e,t)))).join("")}\n\t\t    \t</select>`}getOption(t,e){let a;return a=t===e?"selected":"",`<option ${a} value="${t}">\n\t      \t${t}\n\t      </option>`}getCaption(t,e){return`<div class="exchange-caption" id="${e}">\n\t      \t${t}\n\t      </div>`}getInputArea(){return`\n  \t\t\t<div class="exchange-row">\n    \t\t\t${this.getInputIn(1)}\n    \t\t\t${this.getSelector("USD","selectorValuteIn")}\n    \t\t\t${this.getCaption(this.valuteNameIn,"captionValuteIn")}\n  \t\t\t</div>\n    \t`}getOutputArea(){const t=this.dataValute.USD.Value;return`\n\t\t\t\t<div class="exchange-row">\n\t  \t\t\t${this.getInputOut(t)}\n\t  \t\t\t${this.getSelector("RUR","selectorValuteOut")}\n    \t\t\t${this.getCaption(this.valuteNameOut,"captionValuteOut")}\n\n\t\t\t\t</div>\n\t  \t`}getExchangeModule(){return`<div class="exchange">\n    \t\t\t${this.getInputArea()}\n    \t\t\t<div class="exchange-middle text-extra">=</div>\n    \t\t\t${this.getOutputArea()}\n\t      </div>`}getPageContent(){return`\n    \t\t${this.getPageHeadline()}\n    \t\t${this.getExchangeModule()}\n\n    \t`}changeValuteIn(t){this.valuteIn=t.target.value,this.valuteNameIn=this.dataValute[this.valuteIn].Name,this.valuteNominalIn=this.dataValute[this.valuteIn].Nominal,console.log(this.valuteNominalIn),captionValuteIn.innerHTML=this.valuteNameIn,this.calculate()}changeValuteOut(t){this.valuteOut=t.target.value,this.valuteNameOut=this.dataValute[this.valuteOut].Name,this.valuteNominalOut=this.dataValute[this.valuteOut].Nominal,console.log(this.valuteNameOut),captionValuteOut.innerHTML=this.valuteNameOut,this.calculate()}inputValuteNominal(t){this.valuteInputIn=Number(t.target.value),this.calculate()}calculate(){let t=this.dataValute[this.valuteIn].Value/this.valuteNominalIn*this.valuteInputIn/this.dataValute[this.valuteOut].Value/this.valuteNominalOut;console.log(t),t=t.toFixed(2),inputValuteOut.value=t}render(){main.innerHTML=this.getPageContent(),this.changeSelectorValuteIn=this.changeValuteIn.bind(this),this.changeSelectorValuteOut=this.changeValuteOut.bind(this),this.inputNominal=this.inputValuteNominal.bind(this),selectorValuteIn.addEventListener("change",this.changeSelectorValuteIn),selectorValuteOut.addEventListener("change",this.changeSelectorValuteOut),inputValuteIn.addEventListener("input",this.inputNominal)}removeListeners(){}}class a{constructor(){}getNavBar(){return`\n            <div>\n                ${Object.keys(app.routes).map((t=>this.getNavItem(t,app.routes[t]))).join("")}\n            </div>`}getNavItem(t,e){return console.log(t,e),app.pathname===t?`\n                <div onClick="window.app.navigation('${t}')"  class="nav-item nav-item-active">${e}</div>\n            `:`\n                <div onClick="window.app.navigation('${t}')"  class="nav-item">${e}</div>\n            `}render(){nav.innerHTML=this.getNavBar()}navUpdate(){this.links.forEach((t=>{console.log(t)}))}}class n{constructor(){}getFooterContent(){return'\n    \t\t<div>\n    \t\t\tver. 0.0.1 | source <a href="https://github.com/cheello/ndv-exchange-rate" target="_blank">GitHub</a> | dev by <a href=\'\' target="_blank">Alexander Chachillo</a>\n    \t\t</div>\n    \t'}render(){footer.innerHTML=this.getFooterContent()}}window.app=new class{constructor(){this.pathname=window.location.pathname,this.routes={"/":"Курс валют","/exchange":"Конвертер валют"}}render(){}navigation(t){this.pathname=t,this.nav.render(),"/"===t?this.homePage.render():"/exchange"===t?this.exchangePage.render():(t="/",this.homePage.render()),window.history.pushState({},t,window.location.origin+t)}init(){!function(t,e){let a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){try{var t=JSON.parse(a.responseText)}catch(n){return void console.log(n.message+" in "+a.responseText)}e(t)}},a.open("GET",t,!0),a.send()}("https://www.cbr-xml-daily.ru/daily_json.js",(i=>{this.data=i,this.homePage=new t(this.data),this.exchangePage=new e(this.data),this.nav=new a,this.footer=new n,this.nav.render(),this.navigation(this.pathname),this.footer.render()}))}},app.init();
